<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Official Checkout | Team Fire 64</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-storage-compat.js"></script>

<style>
  :root {
    --flp-blue: #003366;
    --flp-yellow: #ffcc00;
    --text-dark: #1e293b;
    --text-light: #64748b;
    --white: #ffffff;
    --success: #10b981;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif; }
  body { background: #f4f7fa; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
  .checkout-card { background: var(--white); width: 100%; max-width: 400px; border-radius: 24px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.05); padding: 30px 24px; position: relative; min-height: 550px; overflow: hidden; }
  .brand-header { text-align: center; margin-bottom: 25px; }
  .logo-circle { width: 70px; height: 70px; border-radius: 50%; border: 2px solid var(--flp-blue); margin: 0 auto 10px; overflow: hidden; display: flex; align-items: center; justify-content: center; }
  .logo-circle img { width: 100%; height: 100%; object-fit: cover; }
  .team-title { font-size: 13px; font-weight: 800; color: #334155; letter-spacing: 1.2px; text-transform: uppercase; }
  h2 { color: var(--flp-blue); font-size: 20px; text-align: center; margin-bottom: 5px; font-weight: 700; }
  p.subtitle { color: var(--text-light); font-size: 13px; text-align: center; margin-bottom: 25px; }
  .payment-options-container { display: flex; justify-content: center; gap: 12px; margin: 20px 0; }
  .pay-app-btn { flex: 1; cursor: pointer; border: 2px solid #e2e8f0; border-radius: 12px; padding: 8px; background: #fff; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; height: 65px; }
  .pay-app-btn img { max-width: 100%; max-height: 100%; object-fit: contain; }
  .loader-wrapper { display: none; text-align: center; margin: 40px 0; }
  .modern-loader { width: 60px; height: 60px; border-radius: 50%; position: relative; margin: 0 auto 20px; border: 4px solid #f0f0f0; border-top: 4px solid var(--flp-blue); animation: spin 1s linear infinite; }
  @keyframes spin { 100% { transform: rotate(360deg); } }
  .receipt-box { background: #f8fafc; border: 1.5px dashed #cbd5e1; border-radius: 16px; padding: 20px; margin: 20px 0; text-align: left; }
  .receipt-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; }
  .receipt-label { color: var(--text-light); font-weight: 500; }
  .receipt-value { color: var(--text-dark); font-weight: 700; }
  .status-badge { background: #fef3c7; color: #92400e; padding: 4px 12px; border-radius: 50px; font-size: 11px; font-weight: 800; text-transform: uppercase; }
  .btn { width: 100%; padding: 16px; border: none; border-radius: 50px; font-size: 15px; font-weight: 700; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; }
  .btn-blue { background: var(--flp-blue); color: white; }
  .btn-yellow { background: var(--flp-yellow); color: #000; }
  .btn-whatsapp { background: #25D366; color: white; margin-top: 15px; box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3); }
  .step { display: none; }
  .active { display: block; animation: fadeIn 0.4s ease; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .input-field { width: 100%; padding: 14px 16px; border: 1.5px solid #e2e8f0; border-radius: 14px; font-size: 14px; margin-bottom: 12px; outline: none; }
  .label-text { font-size: 12px; font-weight: 700; color: var(--text-dark); margin-bottom: 5px; display: block; }
  .upload-box { border: 2px dashed #cbd5e1; border-radius: 16px; padding: 30px 15px; text-align: center; background: #f8fafc; margin-bottom: 20px; cursor: pointer; }
  #previewImg { width: 100%; max-height: 180px; object-fit: contain; border-radius: 10px; margin-top: 15px; display: none; }
  footer { text-align: center; margin-top: 25px; font-size: 10px; color: #94a3b8; font-weight: 600; }
  #progressText { font-size: 12px; color: var(--flp-blue); font-weight: 700; margin-top: 10px; }
</style>
</head>
<body>

<div class="checkout-card">
  <div class="brand-header">
    <div class="logo-circle"><img src="https://ik.imagekit.io/9jxdbc3z2/Screenshot_2026-02-19-12-07-36-97_680d03679600f7af0b4c700c6b270fe7.jpg" alt="Logo"></div>
    <div class="team-title">Team Fire 64</div>
  </div>

  <div id="step1" class="step active">
    <h2>Registration</h2>
    <p class="subtitle">Enter your official details</p>
    <label class="label-text">Your Name</label>
    <input type="text" id="name" class="input-field" placeholder="Enter Full Name">
    <label class="label-text">Mobile Number</label>
    <input type="tel" id="mobile" class="input-field" placeholder="Enter Mobile Number" maxlength="10">
    <label class="label-text">Sponsored By</label>
    <input type="text" id="sponsor" class="input-field" placeholder="Sponsor ID or Name">
    <button class="btn btn-blue" id="nextBtn" onclick="toStep2()">Next Step</button>
  </div>

  <div id="step2" class="step">
    <div id="payment-content">
        <h2>Secure Checkout</h2>
        <div style="background: #f8fafc; border-radius: 16px; padding: 20px; text-align: center; margin-bottom: 15px; border: 1px solid #edf2f7;">
          <span style="font-size: 10px; font-weight: 800; color: #94a3b8;">TOTAL FEE</span>
          <h1 id="finalAmountText" style="color:var(--flp-blue); font-size:30px;">₹1000</h1>
        </div>
        <div class="payment-options-container">
          <div class="pay-app-btn" onclick="handlePay()"><img src="https://ik.imagekit.io/9jxdbc3z2/27885286451954976638490961843543461413864123n-1684328448765.jpg"></div>
          <div class="pay-app-btn" onclick="handlePay()"><img src="https://ik.imagekit.io/9jxdbc3z2/PhonePe_vertical-16158be8710408f3561e1d07d01d5d89.png"></div>
          <div class="pay-app-btn" onclick="handlePay()"><img src="https://ik.imagekit.io/9jxdbc3z2/Frame-43-1.png"></div>
        </div>
        <button class="btn btn-yellow" onclick="handlePay()">PAY NOW</button>
    </div>
    <div id="pay-loader" class="loader-wrapper"><div class="modern-loader"></div><p>Connecting to Secure UPI...</p></div>
  </div>

  <div id="step3" class="step">
    <h2>Verify Payment</h2>
    <p class="subtitle">Upload screenshot to activate account</p>
    <div class="upload-box" onclick="document.getElementById('fileIn').click()">
      <img src="https://img.icons8.com/fluency/32/stack-of-photos.png"/><br>
      <span id="upTxt" style="font-size:12px; color:var(--text-light); margin-top:8px; display:block;">Click to select screenshot</span>
      <input type="file" id="fileIn" accept="image/*" style="display:none">
      <img id="previewImg">
    </div>
    <button id="finalBtn" class="btn btn-blue" style="opacity:0.5" disabled onclick="handleFinal()">Confirm & Submit</button>
  </div>

  <div id="step4" class="step" style="text-align:center">
    <div id="final-loader" class="loader-wrapper" style="display:block;">
        <div class="modern-loader"></div>
        <p id="progressStatus" style="font-weight:700; color:var(--flp-blue);">Uploading Screenshot...</p>
        <p id="progressText" style="font-size:12px; color:var(--text-light); margin-top:5px;">0 KB / 0 KB</p>
    </div>
    <div id="success-msg" style="display:none">
        <img src="https://img.icons8.com/fluency/80/verified-badge.png"/>
        <h2 style="margin-top:15px; color: #10b981;">Congratulations!</h2>
        <div class="receipt-box">
            <div class="receipt-row"><span class="receipt-label">Name:</span><span class="receipt-value" id="res-name"></span></div>
            <div class="receipt-row"><span class="receipt-label">Mobile:</span><span class="receipt-value" id="res-mobile"></span></div>
            <div class="receipt-row"><span class="receipt-label">Status:</span><span class="status-badge" id="res-status">Pending</span></div>
        </div>
        <a id="whatsappLink" href="#" target="_blank" class="btn btn-whatsapp"><img src="https://img.icons8.com/color/24/whatsapp.png"/> SHARE RECEIPT</a>
    </div>
  </div>
  <footer>100% SECURE ENCRYPTED TRANSACTION</footer>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBEfQUSh8_mLRn1XmeZbmMdQcTU4cuVr4s",
    authDomain: "payment-gateway-7f19b.firebaseapp.com",
    databaseURL: "https://payment-gateway-7f19b-default-rtdb.firebaseio.com",
    projectId: "payment-gateway-7f19b",
    storageBucket: "payment-gateway-7f19b.firebasestorage.app",
    messagingSenderId: "582113309774",
    appId: "1:582113309774:web:d74eef1d305db5c007bf1f"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const storage = firebase.storage();

  let finalAmount = 1000;
  const MY_UPI = "RajForever64@ybl";
  const SPONSOR_PHONE = "919009988071";

  async function toStep2() {
    const n = document.getElementById('name').value;
    const m = document.getElementById('mobile').value;
    if(!n || m.length !== 10) return alert("Enter Name & 10 digit Mobile");

    document.getElementById('nextBtn').innerText = "Verifying...";
    document.getElementById('nextBtn').disabled = true;

    try {
        // PERMANENT CHECK: Jab tak user database me hai, dobara reg nahi hoga
        const userSnap = await db.ref('users/' + m).get();
        if(userSnap.exists()){
            const data = userSnap.val();
            showSuccessUI(data.name, data.mobile, data.status, data.amount);
            return;
        }

        const pSnap = await db.ref('prices/' + m).get();
        if(pSnap.exists()) finalAmount = pSnap.val().amount;
        document.getElementById('finalAmountText').innerText = "₹" + finalAmount;
        
        document.getElementById('step1').classList.remove('active');
        document.getElementById('step2').classList.add('active');
    } catch(e) {
        alert("Connection Error.");
    } finally {
        document.getElementById('nextBtn').innerText = "Next Step";
        document.getElementById('nextBtn').disabled = false;
    }
  }

  function handlePay() {
    window.location.href = `upi://pay?pa=${MY_UPI}&pn=TeamFire64&am=${finalAmount}&cu=INR&tn=TF64-REG-${document.getElementById('mobile').value}`;
    document.getElementById('payment-content').style.display = "none";
    document.getElementById('pay-loader').style.display = "block";
    setTimeout(() => {
        document.getElementById('step2').classList.remove('active');
        document.getElementById('step3').classList.add('active');
    }, 3000);
  }

  document.getElementById('fileIn').onchange = (e) => {
    if(e.target.files[0]) {
        document.getElementById('previewImg').src = URL.createObjectURL(e.target.files[0]);
        document.getElementById('previewImg').style.display = "block";
        document.getElementById('upTxt').innerText = "Screenshot Selected ✅";
        document.getElementById('finalBtn').disabled = false;
        document.getElementById('finalBtn').style.opacity = "1";
    }
  };

  function handleFinal() {
    const name = document.getElementById('name').value;
    const mobile = document.getElementById('mobile').value;
    const sponsor = document.getElementById('sponsor').value || "Direct";
    const file = document.getElementById('fileIn').files[0];

    document.getElementById('step3').classList.remove('active');
    document.getElementById('step4').classList.add('active');

    let totalKb = Math.floor(Math.random() * (950 - 550 + 1)) + 550; 
    let currentKb = 0;

    const progressInterval = setInterval(() => {
        currentKb += Math.floor(Math.random() * 35) + 20; 
        
        if(currentKb >= totalKb) {
            currentKb = totalKb;
            clearInterval(progressInterval);
            // Pehle data save trigger karenge fir UI dikhayenge
            saveAndFinish(name, mobile, sponsor, file, totalKb);
        }
        document.getElementById('progressText').innerText = `${currentKb} KB / ${totalKb} KB`;
        document.getElementById('progressStatus').innerText = `Uploading: ${Math.round((currentKb/totalKb)*100)}%`;
    }, 140); // 2.5 - 3 Seconds
  }

  async function saveAndFinish(name, mobile, sponsor, file, kb) {
    // Data save process start
    const userData = { name, mobile, sponsor, amount: finalAmount, status: "Pending", timestamp: Date.now(), proof: "uploading..." };
    
    try {
        await db.ref('users/' + mobile).set(userData);
        // UI shift
        showSuccessUI(name, mobile, "Pending", finalAmount);
        
        // Storage Background upload
        const ref = storage.ref(`proofs/${mobile}`);
        const snap = await ref.put(file);
        const url = await snap.ref.getDownloadURL();
        await db.ref('users/' + mobile).update({ proof: url });
    } catch(e) {
        console.error(e);
    }
  }

  function showSuccessUI(name, mobile, status, amt) {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step4').classList.add('active');
    document.getElementById('final-loader').style.display = "none";
    document.getElementById('success-msg').style.display = "block";
    
    document.getElementById('res-name').innerText = name;
    document.getElementById('res-mobile').innerText = mobile;
    
    const statusEl = document.getElementById('res-status');
    statusEl.innerText = status || "Pending";
    
    // Status color change based on Admin approval
    if(status === "Approved") {
        statusEl.style.background = "#d1fae5";
        statusEl.style.color = "#065f46";
    }

    const msg = `*Registration Details*%0A%0A*Name:* ${name.toUpperCase()}%0A*Mobile:* ${mobile}%0A*Amount:* ₹${amt}%0A*Status:* ${status || 'Pending'}`;
    document.getElementById('whatsappLink').href = `https://api.whatsapp.com/send?phone=${SPONSOR_PHONE}&text=${msg}`;
  }
</script>
</body>
    </html>
